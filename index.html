<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmy Gyaan: Bollywood Dialogue Quiz</title>
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Rozha+One&family=Poppins:wght@300;400;600&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'filmy-red': '#800000',
                        'filmy-gold': '#FFD700',
                        'filmy-dark': '#1a1a1a',
                        'filmy-cream': '#FFFDD0',
                    },
                    fontFamily: {
                        'display': ['"Rozha One"', 'serif'],
                        'classic': ['"Cinzel"', 'serif'],
                        'body': ['"Poppins"', 'sans-serif'],
                    },
                    animation: {
                        'spotlight': 'spotlight 2s ease-in-out infinite alternate',
                        'pop': 'pop 0.3s ease-out forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        spotlight: {
                            '0%': { boxShadow: '0 0 20px #FFD700' },
                            '100%': { boxShadow: '0 0 60px #FFD700' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #1a1a1a;
            background-image:
                radial-gradient(circle at 50% 50%, #300000 0%, #000000 100%);
            min-height: 100vh;
        }

        .film-strip-border {
            border: 8px solid #000;
            position: relative;
            background: #fff;
        }

        .film-strip-border::before,
        .film-strip-border::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 20px;
            background-image: linear-gradient(to right, #000 50%, transparent 50%);
            background-size: 30px 100%;
        }

        .film-strip-border::before {
            top: 4px;
        }

        .film-strip-border::after {
            bottom: 4px;
        }

        .curtain-pattern {
            background: repeating-linear-gradient(90deg,
                    #800000,
                    #800000 40px,
                    #600000 40px,
                    #600000 80px);
        }

        .gold-text-shadow {
            text-shadow: 2px 2px 0px #000, 4px 4px 10px rgba(255, 215, 0, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #FFD700;
            border-radius: 4px;
        }
    </style>
</head>

<body class="text-filmy-cream font-body overflow-x-hidden flex flex-col items-center justify-center p-4">

    <!-- Main App Container -->
    <div id="app" class="w-full max-w-2xl relative z-10">
        <!-- Dynamic Content Rendered Here -->
    </div>

    <!-- Decorative Background Elements -->
    <div class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-0 opacity-20">
        <i class="fas fa-film absolute text-9xl top-10 left-10 transform -rotate-12 text-filmy-gold"></i>
        <i class="fas fa-video absolute text-9xl bottom-10 right-10 transform rotate-12 text-filmy-gold"></i>
        <i class="fas fa-star absolute text-6xl top-1/2 right-20 animate-pulse text-filmy-gold"></i>
        <i class="fas fa-star absolute text-4xl bottom-1/3 left-20 animate-pulse delay-700 text-filmy-gold"></i>
    </div>

    <script>
        // --- Data ---
        // API Key is injected by the environment at runtime
        const apiKey = "AIzaSyAr9eJJyJiOqjqc0apI86xeievz3tsq5vM";//"AIzaSyApfJnBFmuLt0O-jmht70RCK5_hDqozdM4";

        let quizData = []; // Data will be fetched from API

        // Fallback data for offline mode or API errors
        const fallbackData = [
            {
                dialogue: "Kitne aadmi the?",
                correct: "Gabbar Singh (Sholay)",
                options: ["Gabbar Singh (Sholay)", "Mogambo (Mr. India)", "Kancha Cheena (Agneepath)", "Lion (Kalicharan)"]
            },
            {
                dialogue: "Mogambo khush hua!",
                correct: "Mr. India",
                options: ["Shaan", "Mr. India", "Tezaab", "Tridev"]
            },
            {
                dialogue: "Mere paas Maa hai.",
                correct: "Deewar",
                options: ["Sholay", "Trishul", "Deewar", "Zanjeer"]
            },
            {
                dialogue: "Pushpa, I hate tears.",
                correct: "Amar Prem",
                options: ["Aradhana", "Kati Patang", "Amar Prem", "Safar"]
            },
            {
                dialogue: "Rishte mein toh hum tumhare baap lagte hain, naam hai Shahenshah.",
                correct: "Amitabh Bachchan",
                options: ["Shatrughan Sinha", "Vinod Khanna", "Amitabh Bachchan", "Dharmendra"]
            }
        ];

        // --- State ---
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let isAnswered = false;
        let currentEmojiPuzzle = null;

        // --- API Logic ---

        async function callGemini(prompt, isJson = false) {
            if (!apiKey) {
                console.warn("No API Key found.");
                return null;
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: isJson ? { responseMimeType: "application/json" } : {}
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (error) {
                console.error("Gemini API Call Failed:", error);
                return null;
            }
        }

        async function fetchQuestionsFromGemini() {
            const prompt = `Generate 10 unique Bollywood dialogue quiz questions in JSON format. 
            Focus on iconic dialogues from movies between 1970 and 2024.
            Output strictly a JSON array of objects. 
            Schema: [{"dialogue": "string", "correct": "string", "options": ["string", "string", "string", "string"]}]
            Ensure the "correct" answer is always included in the "options" array.`;

            const textContent = await callGemini(prompt, true);
            if (!textContent) return fallbackData;

            try {
                const parsedData = JSON.parse(textContent);
                if (Array.isArray(parsedData) && parsedData.length > 0) return parsedData;
            } catch (e) {
                console.error("JSON Parse Error", e);
            }
            return fallbackData;
        }

        async function fetchTrivia(dialogue, movie) {
            const triviaContainer = document.getElementById('trivia-content');
            const btn = document.getElementById('trivia-btn');

            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Rolling Camera...`;
            btn.disabled = true;

            const prompt = `Tell me a fun fact or short context about the Bollywood dialogue: "${dialogue}" from the answer "${movie}". Keep it under 3 sentences. Be witty and filmy.`;
            const trivia = await callGemini(prompt, false);

            if (trivia) {
                triviaContainer.innerHTML = `<p class="text-sm md:text-base italic">"${trivia}"</p>`;
                triviaContainer.parentElement.classList.remove('hidden');
            }
            btn.innerHTML = `‚ú® Behind the Scenes`;
            btn.disabled = false;
            btn.classList.add('hidden');
        }

        async function generateFilmyDialogue() {
            const input = document.getElementById('writer-input').value;
            const outputText = document.getElementById('writer-output-text');
            const outputContainer = document.getElementById('writer-output');
            const btn = document.getElementById('writer-btn');

            if (!input.trim()) return;

            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Directing...`;
            btn.disabled = true;

            const prompt = `Convert this boring situation into a dramatic, over-the-top Bollywood dialogue in Hindi (with English transliteration). 
            Situation: "${input}". 
            Make it sound like an iconic Amitabh Bachchan or Shah Rukh Khan line. 
            Format: "Hindi Dialogue" \n\n (Translation/Context)`;

            const response = await callGemini(prompt, false);

            if (response) {
                outputText.innerHTML = response.replace(/\n/g, '<br>');
                outputContainer.classList.remove('hidden');
            }

            btn.innerHTML = `‚ú® Action!`;
            btn.disabled = false;
        }

        async function generateCriticReview(score, total) {
            const prompt = `You are a snarky but entertaining Bollywood film critic (like a mix of a strict reviewer and a filmy uncle). 
            A user just scored ${score} out of ${total} on a Bollywood Dialogue Quiz. 
            Write a 2-sentence review of their performance. Use Hinglish. 
            If score is high, praise them dramatically. If low, roast them gently but dramatically.`;

            const review = await callGemini(prompt, false);
            return review || "Picture flop ho gayi, boss! Better luck next time.";
        }

        async function generateCastingRole() {
            const name = document.getElementById('cast-name').value;
            const trait = document.getElementById('cast-trait').value;
            const btn = document.getElementById('cast-btn');
            const resultDiv = document.getElementById('cast-result');

            if (!name || !trait) return;

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Auditioning...';
            btn.disabled = true;

            const prompt = `Create a fictional Bollywood movie synopsis for a person named "${name}" who is known for "${trait}". 
            1. Give the movie a funny/dramatic Bollywood-style title (Hinglish).
            2. Describe their character role (Hero/Villain/Comic).
            3. One liner plot.
            Output Format:
            Title: [Title]
            Role: [Role Name & Type]
            Plot: [One sentence plot]`;

            const response = await callGemini(prompt, false);

            if (response) {
                resultDiv.innerHTML = `
                    <div class="border-2 border-filmy-gold p-4 rounded bg-black/60 mt-4 text-left animate-pop">
                        <div class="text-center mb-2"><i class="fas fa-film text-3xl text-filmy-gold"></i></div>
                        <pre class="whitespace-pre-wrap font-body text-sm md:text-base text-filmy-cream">${response}</pre>
                    </div>
                `;
            }

            btn.innerHTML = '‚ú® Get My Role';
            btn.disabled = false;
        }

        async function getPrescription() {
            const mood = document.getElementById('mood-input').value;
            const btn = document.getElementById('pharma-btn');
            const resultDiv = document.getElementById('pharma-result');

            if (!mood.trim()) return;

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Consulting Dr. Love...';
            btn.disabled = true;

            const prompt = `Act as a dramatic Bollywood doctor. A patient says they are feeling: "${mood}".
            Prescribe a Bollywood movie and a specific song/scene as a cure.
            Output Format (Plain Text):
            Diagnosis: [Funny diagnosis in Hinglish]
            Prescription: [Movie Name]
            Dosage: [Song/Scene Name]
            Advice: [One liner filmy doctor advice]`;

            const response = await callGemini(prompt, false);

            if (response) {
                resultDiv.innerHTML = `
                    <div class="bg-white text-black p-4 rounded rotate-1 mt-6 shadow-lg border-t-8 border-red-600 animate-pop font-body text-left relative">
                        <div class="absolute -top-3 -right-3 text-4xl">üíä</div>
                        <h3 class="font-display text-xl text-red-800 border-b-2 border-red-100 pb-2 mb-2">Dr. Filmy's Prescription</h3>
                        <pre class="whitespace-pre-wrap font-sans text-sm md:text-base leading-relaxed">${response}</pre>
                        <div class="mt-4 text-right font-cursive text-gray-500 text-xs">Signed, Dr. Prem Chopra</div>
                    </div>
                `;
            }

            btn.innerHTML = 'üíä Get Prescription';
            btn.disabled = false;
        }

        async function getEmojiPuzzle() {
            const container = document.getElementById('emoji-container');
            const loadBtn = document.getElementById('load-emoji-btn');
            const checkBtn = document.getElementById('check-emoji-btn');

            loadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading Reel...';
            loadBtn.disabled = true;

            // Reset UI
            document.getElementById('emoji-display').innerText = '...';
            document.getElementById('emoji-guess').value = '';
            document.getElementById('emoji-result').innerHTML = '';
            checkBtn.disabled = true;

            const prompt = `Generate a Bollywood movie guessing game using emojis. Choose a popular movie.
            Output JSON: {"emojis": "string of emojis", "title": "Movie Title", "hint": "Cryptic text hint"}`;

            const textContent = await callGemini(prompt, true);

            try {
                const puzzle = JSON.parse(textContent);
                if (puzzle && puzzle.emojis && puzzle.title) {
                    currentEmojiPuzzle = puzzle;
                    document.getElementById('emoji-display').innerText = puzzle.emojis;
                    document.getElementById('emoji-hint').innerText = `Hint: ${puzzle.hint}`;
                    checkBtn.disabled = false;
                }
            } catch (e) {
                console.error(e);
            }

            loadBtn.innerHTML = 'üîÑ New Puzzle';
            loadBtn.disabled = false;
        }

        function checkEmojiGuess() {
            const guess = document.getElementById('emoji-guess').value.toLowerCase().trim();
            const resultDiv = document.getElementById('emoji-result');

            if (!currentEmojiPuzzle) return;

            const title = currentEmojiPuzzle.title.toLowerCase();

            // Simple fuzzy match check
            if (guess && title.includes(guess)) {
                resultDiv.innerHTML = `<div class="text-green-400 font-bold animate-pop"><i class="fas fa-check-circle"></i> Correct! It's "${currentEmojiPuzzle.title}"</div>`;
            } else {
                resultDiv.innerHTML = `<div class="text-red-400 font-bold animate-shake"><i class="fas fa-times-circle"></i> Wrong! It was "${currentEmojiPuzzle.title}"</div>`;
            }
        }

        // --- Utils ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- Components ---

        function getRank(score, total) {
            const percentage = (score / total) * 100;
            if (percentage === 100) return { title: "BLOCKBUSTER HIT!", icon: "fa-trophy", color: "text-yellow-400" };
            if (percentage >= 70) return { title: "SUPERHIT!", icon: "fa-star", color: "text-green-400" };
            if (percentage >= 40) return { title: "AVERAGE", icon: "fa-ticket-alt", color: "text-orange-400" };
            return { title: "FLOP", icon: "fa-heart-broken", color: "text-red-500" };
        }

        // --- Views ---

        function renderLoadingScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg p-12 text-center animate-pop max-w-lg mx-auto relative overflow-hidden shadow-[0_0_60px_rgba(0,0,0,0.8)]">
                    <div class="flex justify-center mb-8">
                        <i class="fas fa-compact-disc text-6xl text-filmy-gold animate-spin"></i>
                    </div>
                    <h2 class="font-display text-3xl text-white mb-4 tracking-widest">SETTING THE SCENE...</h2>
                    <p class="font-body text-filmy-gold animate-pulse">Fetching fresh scripts from the writers' room.</p>
                </div>
             `;
        }

        function renderStartScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="bg-filmy-red border-4 border-filmy-gold rounded-lg shadow-[0_0_50px_rgba(0,0,0,0.8)] p-8 text-center animate-pop relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-8 h-full curtain-pattern opacity-50"></div>
                    <div class="absolute top-0 right-0 w-8 h-full curtain-pattern opacity-50"></div>

                    <div class="mb-6 flex justify-center">
                        <img src="logo.png" alt="Filmy Gyaan Logo" class="w-32 h-32 object-contain drop-shadow-[0_0_15px_rgba(255,215,0,0.5)] animate-bounce">
                    </div>
                    
                    <h1 class="font-display text-5xl md:text-6xl mb-2 text-filmy-gold gold-text-shadow uppercase tracking-wider">
                        Filmy Gyaan
                    </h1>
                    <p class="font-classic text-xl text-white mb-8 border-b-2 border-filmy-gold inline-block pb-2">
                        The Ultimate Bollywood Hub
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                        <button onclick="startGame()" class="col-span-1 md:col-span-2 group relative flex items-center justify-center px-8 py-4 text-lg font-bold text-black transition-all duration-200 bg-filmy-gold font-display rounded-lg focus:outline-none hover:bg-white hover:scale-105">
                            <span class="mr-2"><i class="fas fa-play"></i></span>
                            PLAY QUIZ
                        </button>

                        <button onclick="renderWriterScreen()" class="group relative flex items-center justify-center px-4 py-3 text-sm font-bold text-white transition-all duration-200 bg-transparent border-2 border-filmy-gold font-display rounded-lg hover:bg-filmy-gold hover:text-black hover:scale-105">
                            <span class="mr-2"><i class="fas fa-pen-nib"></i></span>
                            ‚ú® FILMY WRITER
                        </button>

                         <button onclick="renderCastingScreen()" class="group relative flex items-center justify-center px-4 py-3 text-sm font-bold text-white transition-all duration-200 bg-transparent border-2 border-filmy-gold font-display rounded-lg hover:bg-filmy-gold hover:text-black hover:scale-105">
                            <span class="mr-2"><i class="fas fa-chair"></i></span>
                            ‚ú® CASTING DIRECTOR
                        </button>

                        <button onclick="renderPharmacistScreen()" class="group relative flex items-center justify-center px-4 py-3 text-sm font-bold text-white transition-all duration-200 bg-transparent border-2 border-filmy-gold font-display rounded-lg hover:bg-filmy-gold hover:text-black hover:scale-105">
                            <span class="mr-2"><i class="fas fa-pills"></i></span>
                            üíä FILMY PHARMACIST
                        </button>

                        <button onclick="renderEmojiScreen()" class="group relative flex items-center justify-center px-4 py-3 text-sm font-bold text-white transition-all duration-200 bg-transparent border-2 border-filmy-gold font-display rounded-lg hover:bg-filmy-gold hover:text-black hover:scale-105">
                            <span class="mr-2"><i class="fas fa-puzzle-piece"></i></span>
                            üß© EMOJI PICTIONARY
                        </button>

                        <button onclick="renderRemixScreen()" class="col-span-1 md:col-span-2 group relative flex items-center justify-center px-4 py-3 text-sm font-bold text-white transition-all duration-200 bg-transparent border-2 border-filmy-gold font-display rounded-lg hover:bg-filmy-gold hover:text-black hover:scale-105">
                            <span class="mr-2"><i class="fas fa-random"></i></span>
                            üé¨ THE CLIMAX REMIX
                        </button>
                    </div>
                </div>
            `;
        }

        function renderWriterScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                 <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg shadow-2xl p-6 md:p-8 animate-pop relative overflow-hidden max-w-xl mx-auto">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-4 text-filmy-gold hover:text-white transition-colors">
                        <i class="fas fa-arrow-left text-2xl"></i>
                    </button>
                    
                    <h2 class="text-center font-display text-3xl text-filmy-gold gold-text-shadow mb-2 mt-4">Filmy Writer</h2>
                    <p class="text-center text-gray-300 mb-6 text-sm">Turn your boring life into a Blockbuster!</p>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-filmy-gold mb-2 font-classic">Situation (e.g. "Asking mom for food")</label>
                            <textarea id="writer-input" rows="3" class="w-full bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none focus:ring-1 focus:ring-filmy-gold placeholder-gray-600" placeholder="Type a situation here..."></textarea>
                        </div>

                        <button id="writer-btn" onclick="generateFilmyDialogue()" class="w-full py-3 bg-gradient-to-r from-red-800 to-red-900 text-white font-bold rounded border border-filmy-gold hover:from-red-700 hover:to-red-800 transition-all font-display tracking-wide shadow-[0_0_15px_rgba(255,0,0,0.3)]">
                            ‚ú® Action!
                        </button>

                        <div id="writer-output" class="hidden mt-6 bg-black/40 border border-filmy-gold/30 p-4 rounded-lg relative">
                             <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-filmy-gold text-black text-xs font-bold px-2 py-1 rounded uppercase">
                                Dialogue
                            </div>
                            <p id="writer-output-text" class="text-center text-lg md:text-xl text-filmy-cream font-classic leading-relaxed mt-2"></p>
                             <div class="text-center mt-4 text-filmy-gold opacity-50 text-sm">
                                <i class="fas fa-video"></i> Directed by Smit Chitroda
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCastingScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                 <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg shadow-2xl p-6 md:p-8 animate-pop relative overflow-hidden max-w-xl mx-auto">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-4 text-filmy-gold hover:text-white transition-colors">
                        <i class="fas fa-arrow-left text-2xl"></i>
                    </button>
                    
                    <h2 class="text-center font-display text-3xl text-filmy-gold gold-text-shadow mb-2 mt-4">Casting Couch</h2>
                    <p class="text-center text-gray-300 mb-6 text-sm">Find out your destined Bollywood Role!</p>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-filmy-gold mb-2 font-classic">Your Name</label>
                            <input type="text" id="cast-name" class="w-full bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none" placeholder="e.g. Rahul">
                        </div>
                        <div>
                            <label class="block text-filmy-gold mb-2 font-classic">One Quirk / Habit</label>
                            <input type="text" id="cast-trait" class="w-full bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none" placeholder="e.g. Always late, Loves Samosas">
                        </div>

                        <button id="cast-btn" onclick="generateCastingRole()" class="w-full py-3 bg-gradient-to-r from-purple-800 to-purple-900 text-white font-bold rounded border border-filmy-gold hover:from-purple-700 hover:to-purple-800 transition-all font-display tracking-wide shadow-[0_0_15px_rgba(128,0,128,0.3)]">
                            ‚ú® Get My Role
                        </button>

                        <div id="cast-result" class="mt-6"></div>
                    </div>
                </div>
            `;
        }

        function renderPharmacistScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                 <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg shadow-2xl p-6 md:p-8 animate-pop relative overflow-hidden max-w-xl mx-auto">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-4 text-filmy-gold hover:text-white transition-colors">
                        <i class="fas fa-arrow-left text-2xl"></i>
                    </button>
                    
                    <h2 class="text-center font-display text-3xl text-filmy-gold gold-text-shadow mb-2 mt-4">The Filmy Pharmacist</h2>
                    <p class="text-center text-gray-300 mb-6 text-sm">Laughter (and Drama) is the best medicine!</p>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-filmy-gold mb-2 font-classic">How are you feeling today?</label>
                            <input type="text" id="mood-input" class="w-full bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none" placeholder="e.g. Heartbroken, Bored, Angry boss...">
                        </div>

                        <button id="pharma-btn" onclick="getPrescription()" class="w-full py-3 bg-gradient-to-r from-green-800 to-green-900 text-white font-bold rounded border border-filmy-gold hover:from-green-700 hover:to-green-800 transition-all font-display tracking-wide shadow-[0_0_15px_rgba(0,128,0,0.3)]">
                            üíä Get Prescription
                        </button>

                        <div id="pharma-result" class="mt-6"></div>
                    </div>
                </div>
            `;
        }

        function renderEmojiScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                 <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg shadow-2xl p-6 md:p-8 animate-pop relative overflow-hidden max-w-xl mx-auto">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-4 text-filmy-gold hover:text-white transition-colors">
                        <i class="fas fa-arrow-left text-2xl"></i>
                    </button>
                    
                    <h2 class="text-center font-display text-3xl text-filmy-gold gold-text-shadow mb-2 mt-4">Emoji Pictionary</h2>
                    <p class="text-center text-gray-300 mb-6 text-sm">Guess the movie from the emojis!</p>

                    <div id="emoji-container" class="text-center space-y-6">
                        <div class="bg-white/10 rounded-lg p-6 border border-filmy-gold/30">
                            <div id="emoji-display" class="text-5xl md:text-6xl animate-bounce mb-4">‚ùì üé¨ ‚ùì</div>
                            <div id="emoji-hint" class="text-filmy-gold text-sm italic min-h-[20px]"></div>
                        </div>

                        <div class="flex gap-2">
                            <input type="text" id="emoji-guess" class="flex-1 bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none" placeholder="Enter Movie Name...">
                            <button id="check-emoji-btn" disabled onclick="checkEmojiGuess()" class="px-4 py-2 bg-green-700 text-white rounded font-bold disabled:opacity-50">Check</button>
                        </div>

                        <div id="emoji-result" class="min-h-[30px]"></div>

                         <button id="load-emoji-btn" onclick="getEmojiPuzzle()" class="w-full py-3 bg-gradient-to-r from-blue-800 to-blue-900 text-white font-bold rounded border border-filmy-gold hover:from-blue-700 hover:to-blue-800 transition-all font-display tracking-wide">
                            üîÑ Load New Puzzle
                        </button>
                    </div>
                </div>
            `;
            // Auto load first puzzle
            setTimeout(getEmojiPuzzle, 500);
        }

        function renderRemixScreen() {
            const app = document.getElementById('app');
            app.innerHTML = `
                 <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg shadow-2xl p-6 md:p-8 animate-pop relative overflow-hidden max-w-xl mx-auto">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-4 text-filmy-gold hover:text-white transition-colors">
                        <i class="fas fa-arrow-left text-2xl"></i>
                    </button>
                    
                    <h2 class="text-center font-display text-3xl text-filmy-gold gold-text-shadow mb-2 mt-4">The Climax Remix</h2>
                    <p class="text-center text-gray-300 mb-6 text-sm">What if... things ended differently?</p>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-filmy-gold mb-2 font-classic">Movie Name</label>
                            <input type="text" id="remix-input" class="w-full bg-black/50 border border-filmy-gold/50 rounded p-3 text-white focus:border-filmy-gold focus:outline-none" placeholder="e.g. DDLJ, Sholay, 3 Idiots...">
                        </div>

                        <button id="remix-btn" onclick="generateClimaxRemix()" class="w-full py-3 bg-gradient-to-r from-pink-800 to-pink-900 text-white font-bold rounded border border-filmy-gold hover:from-pink-700 hover:to-pink-800 transition-all font-display tracking-wide shadow-[0_0_15px_rgba(255,20,147,0.3)]">
                            üé¨ Remix It!
                        </button>

                        <div id="remix-output" class="hidden mt-6 bg-black/40 border border-filmy-gold/30 p-4 rounded-lg relative">
                             <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-filmy-gold text-black text-xs font-bold px-2 py-1 rounded uppercase">
                                Alternate Ending
                            </div>
                            <p id="remix-output-text" class="text-left text-lg text-filmy-cream font-body leading-relaxed mt-2 whitespace-pre-wrap"></p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function generateClimaxRemix() {
            const input = document.getElementById('remix-input').value;
            const outputText = document.getElementById('remix-output-text');
            const outputContainer = document.getElementById('remix-output');
            const btn = document.getElementById('remix-btn');

            if (!input.trim()) return;

            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Rewriting History...`;
            btn.disabled = true;

            const prompt = `Rewrite the ending of the Bollywood movie "${input}" in a shocking, funny, or twisted way. 
            Keep it dramatic and under 100 words. Use Hinglish. 
            Start with "What if..."`;

            const response = await callGemini(prompt, false);

            if (response) {
                outputText.innerHTML = response;
                outputContainer.classList.remove('hidden');
            }

            btn.innerHTML = `üé¨ Remix It!`;
            btn.disabled = false;
        }

        function renderQuizScreen() {
            const currentQ = shuffledQuestions[currentQuestionIndex];
            const app = document.getElementById('app');
            const currentOptions = shuffleArray([...currentQ.options]);

            app.innerHTML = `
                <div class="bg-filmy-dark border-y-8 border-black relative rounded-lg shadow-2xl overflow-hidden animate-pop max-w-xl mx-auto">
                    <div class="h-6 bg-white w-full flex justify-between px-2 items-center overflow-hidden">
                        ${Array(20).fill(0).map(() => '<div class="w-4 h-3 bg-black rounded-sm mx-1"></div>').join('')}
                    </div>

                    <div class="p-6 md:p-8 bg-gradient-to-b from-gray-900 to-black relative">
                        <div class="flex justify-between items-center mb-6 text-filmy-gold font-classic border-b border-gray-700 pb-4">
                            <div class="text-sm md:text-base tracking-widest">
                                SCENE ${currentQuestionIndex + 1} / ${shuffledQuestions.length}
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-star text-yellow-500"></i>
                                <span class="text-xl">${score}00 CR</span>
                            </div>
                        </div>

                        <div class="mb-8 text-center">
                            <div class="inline-block mb-2 opacity-50 text-filmy-gold"><i class="fas fa-quote-left text-2xl"></i></div>
                            <h2 class="font-display text-2xl md:text-3xl text-white leading-relaxed tracking-wide px-2 drop-shadow-lg">
                                "${currentQ.dialogue}"
                            </h2>
                            <div class="inline-block mt-2 opacity-50 text-filmy-gold"><i class="fas fa-quote-right text-2xl"></i></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="options-container">
                            ${currentOptions.map(option => `
                                <button onclick="checkAnswer(this, '${option.replace(/'/g, "\\'")}')" 
                                    class="option-btn relative w-full p-4 bg-filmy-red/20 border-2 border-filmy-gold/40 text-filmy-cream hover:bg-filmy-red hover:border-filmy-gold rounded-lg transition-all duration-200 text-left font-semibold group flex items-center">
                                    <span class="w-6 h-6 rounded-full border border-filmy-gold/50 flex items-center justify-center text-xs mr-3 group-hover:bg-filmy-gold group-hover:text-black transition-colors">
                                        <i class="fas fa-film"></i>
                                    </span>
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                        
                         <div id="trivia-container" class="hidden mb-6 flex flex-col items-center">
                            <div class="w-full bg-yellow-900/20 border border-yellow-600/30 rounded p-4 mb-2 hidden animate-pop">
                                <div class="flex items-start gap-3 text-yellow-500">
                                    <i class="fas fa-lightbulb mt-1"></i>
                                    <div id="trivia-content" class="text-left"></div>
                                </div>
                            </div>
                            <button id="trivia-btn" onclick="fetchTrivia('${currentQ.dialogue.replace(/'/g, "\\'")}', '${currentQ.correct.replace(/'/g, "\\'")}')" 
                                class="text-xs md:text-sm px-4 py-2 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-500 hover:to-purple-500 transition-all shadow-lg flex items-center gap-2">
                                ‚ú® Behind the Scenes
                            </button>
                        </div>

                        <div id="next-btn-container" class="h-12 flex justify-center opacity-0 transition-opacity duration-300 pointer-events-none">
                            <button onclick="nextQuestion()" class="px-6 py-2 bg-filmy-gold text-black font-bold rounded-full hover:bg-white transition-colors font-display tracking-wider flex items-center gap-2 shadow-[0_0_15px_rgba(255,215,0,0.5)]">
                                NEXT SCENE <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="h-6 bg-white w-full flex justify-between px-2 items-center overflow-hidden">
                        ${Array(20).fill(0).map(() => '<div class="w-4 h-3 bg-black rounded-sm mx-1"></div>').join('')}
                    </div>
                </div>
            `;
            isAnswered = false;
        }

        function checkAnswer(btnElement, selectedOption) {
            if (isAnswered) return;
            isAnswered = true;

            const currentQ = shuffledQuestions[currentQuestionIndex];
            const optionsContainer = document.getElementById('options-container');
            const allButtons = optionsContainer.querySelectorAll('button');

            if (selectedOption === currentQ.correct) {
                score++;
                btnElement.classList.remove('bg-filmy-red/20', 'border-filmy-gold/40');
                btnElement.classList.add('bg-green-700', 'border-green-400', 'text-white', 'shadow-[0_0_15px_rgba(74,222,128,0.5)]');
                btnElement.querySelector('i').className = 'fas fa-check';
            } else {
                btnElement.classList.remove('bg-filmy-red/20', 'border-filmy-gold/40');
                btnElement.classList.add('bg-red-700', 'border-red-400', 'text-white', 'animate-shake');
                btnElement.querySelector('i').className = 'fas fa-times';

                allButtons.forEach(btn => {
                    if (btn.innerText.includes(currentQ.correct)) {
                        btn.classList.remove('bg-filmy-red/20', 'border-filmy-gold/40');
                        btn.classList.add('bg-green-700/50', 'border-green-400', 'text-white');
                    }
                });
            }

            const nextContainer = document.getElementById('next-btn-container');
            nextContainer.classList.remove('opacity-0', 'pointer-events-none');

            const triviaContainer = document.getElementById('trivia-container');
            triviaContainer.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuestions.length) {
                renderQuizScreen();
            } else {
                renderResultScreen();
            }
        }

        async function renderResultScreen() {
            const rank = getRank(score, shuffledQuestions.length);
            const app = document.getElementById('app');

            // Initial Render without Review
            app.innerHTML = `
                <div class="bg-filmy-dark border-4 border-filmy-gold rounded-lg p-8 text-center animate-pop max-w-lg mx-auto relative overflow-hidden shadow-[0_0_60px_rgba(128,0,0,0.6)]">
                    <div class="absolute top-[-50%] left-1/2 transform -translate-x-1/2 w-24 h-full bg-white/10 blur-xl rotate-12 pointer-events-none"></div>

                    <div class="mb-6">
                        <div class="w-24 h-24 mx-auto bg-filmy-gold rounded-full flex items-center justify-center text-4xl text-black shadow-lg mb-4 animate-spotlight">
                            <i class="fas ${rank.icon}"></i>
                        </div>
                        <h2 class="font-display text-4xl text-filmy-gold gold-text-shadow mb-2">THE VERDICT</h2>
                    </div>

                    <div class="bg-black/40 rounded-xl p-6 border border-white/10 mb-8">
                        <h3 class="text-2xl font-bold ${rank.color} mb-2">${rank.title}</h3>
                        
                        <!-- AI Critic Review Slot -->
                        <div id="ai-review" class="min-h-[60px] flex items-center justify-center">
                             <span class="text-gray-400 text-sm animate-pulse">Waiting for critic review... <i class="fas fa-pen-fancy"></i></span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-center border-t border-gray-700 pt-4 mt-4">
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">Box Office</p>
                                <p class="text-2xl font-bold text-white">${score}00 CR</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">Accuracy</p>
                                <p class="text-2xl font-bold text-white">${Math.round((score / shuffledQuestions.length) * 100)}%</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-3">
                        <button onclick="startGame()" class="bg-filmy-red hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 shadow-lg flex items-center justify-center mx-auto gap-2 font-display tracking-wider border border-filmy-gold w-full">
                            <i class="fas fa-redo"></i> NEW MOVIE (RETAKE)
                        </button>
                        <button onclick="renderStartScreen()" class="text-filmy-gold hover:text-white underline text-sm">
                            Back to Main Menu
                        </button>
                    </div>
                </div>
            `;

            // Trigger Gemini to generate the review
            const reviewText = await generateCriticReview(score, shuffledQuestions.length);
            const reviewEl = document.getElementById('ai-review');
            if (reviewEl) {
                reviewEl.innerHTML = `<p class="text-gray-300 italic text-sm md:text-base">"${reviewText}"</p>`;
            }
        }

        // --- Controller ---

        async function startGame() {
            renderLoadingScreen();

            const rawData = await fetchQuestionsFromGemini();
            quizData = rawData || fallbackData;

            shuffledQuestions = shuffleArray([...quizData]);

            if (shuffledQuestions.length > 10) shuffledQuestions = shuffledQuestions.slice(0, 10);

            currentQuestionIndex = 0;
            score = 0;
            renderQuizScreen();
        }

        // Initialize
        renderStartScreen();

    </script>
</body>

</html>
